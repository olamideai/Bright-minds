<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard | BrightMinds Quiz</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }

    .login-container, .admin-container {
      background: white;
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      text-align: center;
      max-width: 400px;
      width: 100%;
    }

    .admin-container {
      max-width: 800px;
      display: none;
    }

    .lock-icon {
      font-size: 60px;
      margin-bottom: 20px;
    }

    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 28px;
    }

    p {
      color: #666;
      margin-bottom: 30px;
    }

    .input-group {
      margin-bottom: 20px;
    }

    input {
      width: 100%;
      padding: 15px 20px;
      border: 2px solid #e0e0e0;
      border-radius: 12px;
      font-size: 16px;
      outline: none;
    }

    input:focus {
      border-color: #667eea;
    }

    .btn {
      width: 100%;
      padding: 15px;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
    }

    .btn-danger {
      background: linear-gradient(135deg, #f56565 0%, #c53030 100%);
      color: white;
      margin-top: 10px;
    }

    .error-msg {
      color: #e74c3c;
      margin-top: 15px;
      font-size: 14px;
      display: none;
      padding: 10px;
      background: #fee;
      border-radius: 8px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin: 30px 0;
    }

    .stat-card {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 12px;
      border-left: 4px solid #667eea;
    }

    .stat-card h3 {
      color: #667eea;
      font-size: 28px;
      margin-bottom: 5px;
    }

    .stat-card p {
      color: #666;
      font-size: 14px;
      margin: 0;
    }

    .danger-zone {
      background: #fff5f5;
      border: 2px dashed #fc8181;
      border-radius: 16px;
      padding: 30px;
      margin-top: 30px;
    }

    .warning-icon {
      font-size: 50px;
      margin-bottom: 15px;
    }

    .danger-zone h2 {
      color: #c53030;
      margin-bottom: 10px;
    }

    .status-msg {
      margin-top: 20px;
      padding: 15px;
      border-radius: 10px;
      display: none;
    }

    .status-msg.success {
      background: #c6f6d5;
      color: #22543d;
      display: block;
    }

    .status-msg.error {
      background: #fed7d7;
      color: #742a2a;
      display: block;
    }

    .status-msg.loading {
      background: #bee3f8;
      color: #2a4365;
      display: block;
    }

    .logout-btn {
      margin-top: 20px;
      background: #e2e8f0;
      color: #4a5568;
    }
  </style>
</head>
<body>

  <!-- Step 1: Firebase Auth Login -->
  <div class="login-container" id="authScreen">
    <div class="lock-icon">üîê</div>
    <h1>Admin Login</h1>
    <p>Sign in with your admin account</p>
    
    <div class="input-group">
      <input type="email" id="adminEmail" placeholder="Admin Email" value="">
    </div>
    <div class="input-group">
      <input type="password" id="adminPassword" placeholder="Password" value="">
    </div>
    
    <button class="btn btn-primary" onclick="signIn()">
      üîì Sign In
    </button>
    
    <p class="error-msg" id="authError"></p>
  </div>

  <!-- Step 2: Password Check -->
  <div class="login-container" id="passwordScreen" style="display: none;">
    <div class="lock-icon">üîí</div>
    <h1>Admin Access</h1>
    <p>Enter admin password to continue</p>
    
    <div class="input-group">
      <input type="password" id="adminPass" placeholder="Enter password" onkeypress="if(event.key==='Enter')checkPassword()">
    </div>
    
    <button class="btn btn-primary" onclick="checkPassword()">
      ‚úÖ Verify
    </button>
    
    <p class="error-msg" id="loginError">Incorrect password. Try again.</p>
  </div>

  <!-- Step 3: Admin Dashboard -->
  <div class="admin-container" id="adminPanel">
    <h1>üõ†Ô∏è Admin Dashboard</h1>
    <p>Manage BrightMinds Quiz Leaderboard</p>
    
    <div class="stats-grid">
      <div class="stat-card">
        <h3 id="totalRecords">-</h3>
        <p>Total Records</p>
      </div>
      <div class="stat-card">
        <h3 id="totalUsers">-</h3>
        <p>Unique Users</p>
      </div>
      <div class="stat-card">
        <h3 id="avgScore">-</h3>
        <p>Avg Score</p>
      </div>
    </div>

    <div class="danger-zone">
      <div class="warning-icon">‚ö†Ô∏è</div>
      <h2>Danger Zone</h2>
      <p>Clearing the leaderboard will permanently delete ALL quiz attempts.</p>
      
      <button class="btn btn-danger" id="clearBtn" onclick="clearLeaderboard()">
        üóëÔ∏è Clear Leaderboard
      </button>
      
      <div class="status-msg" id="statusMsg"></div>
    </div>

    <button class="btn logout-btn" onclick="logout()">üîí Lock Dashboard</button>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-auth.js";
    import { getFirestore, collection, getDocs, doc, query, limit, writeBatch } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD3F-UbR6PWNlu5FiELF8C9JvDIjo2Ptog",
      authDomain: "brightminds-quiz.firebaseapp.com",
      projectId: "brightminds-quiz",
      storageBucket: "brightminds-quiz.firebasestorage.app",
      messagingSenderId: "520516877024",
      appId: "1:520516877024:web:3310b7678ba23d1094ae85",
      measurementId: "G-XYF3JQ5HZ3"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // üîë Admin password (change this!)
    const ADMIN_PASSWORD = 'admin123';
    let currentUser = null;

    // Step 1: Firebase Auth Sign In
    window.signIn = async function() {
      const email = document.getElementById('adminEmail').value;
      const password = document.getElementById('adminPassword').value;
      const errorEl = document.getElementById('authError');
      
      if (!email || !password) {
        errorEl.textContent = 'Please enter email and password';
        errorEl.style.display = 'block';
        return;
      }
      
      try {
        const userCredential = await signInWithEmailAndPassword(auth, email, password);
        currentUser = userCredential.user;
        console.log('Signed in:', currentUser.email);
        
        // Show password screen
        document.getElementById('authScreen').style.display = 'none';
        document.getElementById('passwordScreen').style.display = 'block';
        
      } catch (error) {
        console.error('Auth error:', error);
        errorEl.textContent = 'Invalid email or password';
        errorEl.style.display = 'block';
      }
    };

    // Step 2: Check Admin Password
    window.checkPassword = function() {
      const input = document.getElementById('adminPass').value;
      
      if (input === ADMIN_PASSWORD) {
        document.getElementById('passwordScreen').style.display = 'none';
        document.getElementById('adminPanel').style.display = 'block';
        loadStats();
      } else {
        document.getElementById('loginError').style.display = 'block';
        document.getElementById('adminPass').value = '';
      }
    };

    // Load Stats
    async function loadStats() {
      try {
        const q = query(collection(db, 'attempts'), limit(500));
        const snapshot = await getDocs(q);
        
        const uniqueUsers = new Set();
        let totalScore = 0;
        
        snapshot.forEach(doc => {
          const data = doc.data();
          uniqueUsers.add(data.userId);
          totalScore += data.percentage || 0;
        });
        
        document.getElementById('totalRecords').textContent = snapshot.size;
        document.getElementById('totalUsers').textContent = uniqueUsers.size;
        document.getElementById('avgScore').textContent = snapshot.size > 0 
          ? Math.round(totalScore / snapshot.size) + '%' 
          : '0%';
          
      } catch (error) {
        console.error('Error:', error);
        document.getElementById('statusMsg').className = 'status-msg error';
        document.getElementById('statusMsg').textContent = 'Error: ' + error.message;
      }
    }

    // Clear Leaderboard
    window.clearLeaderboard = async function() {
      if (!confirm('‚ö†Ô∏è Delete ALL leaderboard data?')) return;
      if (!confirm('üî¥ This cannot be undone! Confirm?')) return;
      
      const btn = document.getElementById('clearBtn');
      const status = document.getElementById('statusMsg');
      
      btn.disabled = true;
      status.className = 'status-msg loading';
      status.textContent = 'üóëÔ∏è Deleting...';
      
      try {
        const q = query(collection(db, 'attempts'), limit(500));
        const snapshot = await getDocs(q);
        
        if (snapshot.empty) {
          status.className = 'status-msg success';
          status.textContent = 'Already empty!';
          btn.disabled = false;
          return;
        }
        
        const batch = writeBatch(db);
        let count = 0;
        
        snapshot.forEach((docSnap) => {
          batch.delete(doc(db, 'attempts', docSnap.id));
          count++;
        });
        
        await batch.commit();
        
        status.className = 'status-msg success';
        status.textContent = `‚úÖ Deleted ${count} records!`;
        
        document.getElementById('totalRecords').textContent = '0';
        document.getElementById('totalUsers').textContent = '0';
        document.getElementById('avgScore').textContent = '0%';
        
      } catch (error) {
        console.error('Error:', error);
        status.className = 'status-msg error';
        status.textContent = '‚ùå Error: ' + error.message;
      } finally {
        btn.disabled = false;
      }
    };

    // Logout
    window.logout = async function() {
      await signOut(auth);
      currentUser = null;
      document.getElementById('adminPanel').style.display = 'none';
      document.getElementById('authScreen').style.display = 'block';
      document.getElementById('adminEmail').value = '';
      document.getElementById('adminPassword').value = '';
      document.getElementById('adminPass').value = '';
    };
  </script>

</body>
</html>

